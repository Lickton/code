一个典型的CPU有运算器、控制器、寄存器等器件构成，这些器件靠内部总线相连。第一章所说的总线是相对于内部总线来说是外部总线。

在CPU中：
+ 运算器进行信息处理
+ 寄存器进行信息储存
+ 控制器控制各种器件进行工作
+ 内部总线连接各种器件，在它们之间进行数据的传送

对于一个汇编程序员来说：CPU中的主要部件是寄存器，是CPU中程序员可以用指令读写的部件，可以通过改变各种寄存器中的内容来实现对CPU的控制。

## 2.1 通用寄存器

8086CPU都是16位的，可以存放两个字节。
`AX,BX,CX,DX`这四个寄存器通常用于存放一般性的数据，被成为通用寄存器。

![[Pasted image 20220116113029.png]]
![[Pasted image 20220116113803.png]]

8086CPU的`AX,BX,CX,DX`这4个寄存器都可以分为两个独立使用的8位寄存器来用。
例如：`AX -> AH + AL`

![[Pasted image 20220116113738.png]]
## 2.2 字在寄存器中的存储

8086CPU可以一次性处理`byte(8 bit)`和`word(2 byte, 分别被成为这个字的高位字节和低位字节)`两种尺寸的数据
![[Pasted image 20220116114648.png]]

## 2.3 几条汇编指令

在写一条汇编指令或一个寄存器的名称时不区分大小写。

+ CPU在执行指令时会认为`ah`和`al`是两个不相关的寄存器
+ 在数据传送或运算时，要注意指令的两个操作对象的位数应当是一致的。

## 检测点 2.1

一、写出每条汇编指令执行后相关寄存器中的值

1. AX = F4A3H
2. AX = 31A3H
3. AX = 3123H
4. AX = 6246H
5. BX = 826CH
6. CX = 6246H
7. AX = 826CH
8. AX = 04D8H
9. AX = 0482H
10. AX = 6C82H
11. AX = D882H
12. AX = D888H
13. AX = D810H
14. AX = 6246H

二、最多使用4条指令，编程2的4次方

```asm
mov ax,2
add ax,ax
add ax,ax
add ax,ax
```

## 2.4 物理地址

所有的内存单元构成的存储单元是一个一维的线性空间，每一个内存单元在这个空间内都有唯一的地址，将此唯一的地址称为物理地址。

CPU通过地址总线送入存储器的，必须是一个内存单元的物理地址。在CPU向地址总线上发出物理地址之前，必须现在内部先形成这个物理地址。

## 2.5 16位结构的CPU

16位结构描述了一个CPU具有以下结构：
+ 运算器一次最多可以处理16位的数据
+ 寄存器的最大宽度为16位
+ 寄存器和运算器之间的通路位为16位

## 2.6 8086CPU给出物理地址的方法

8086CPU采用一种在内部用2个16位地址合成的方法来形成一个20位的物理地址

![[Pasted image 20220116151410.png]]
当8086CPU要读写内存时：
1. CPU中相关部件提供两个16位地址，一个称为段地址，另一个称为偏移地址
2. 段地址和偏移地址通过内部总线送入地址加法器
3. 地址加法器将两个16位地址合成为一个20位的物理地址
4. 地址加法器通过内部总线将29位物理地址送入输入输出控制电路
5. 输入输出控制电路将20位物理地址送上地址总线
6. 20位物理地址被地址总线传送到储存器中

地址加法器采用**物理地址=段地址 x 16 + 偏移地址**

例如8086CPU要访问 123C8H 的内存单元
![[Pasted image 20220116152550.png]]
> 16进制书 x 16 相当于左移一位。一个数据的十进制形式左移1位，相当于乘以10。一个X进制的数据左移1位相当于乘以X。

## 2.7 “段地址x16+偏移地址=物理地址“的本质含义

本质含义是：CPU在访问内存时，用一个基础地址（段地址x16）和一个相对于基础地址的偏移地址相加，给出内存单元的物理地址。

8086CPU的这种寻址模式是“基础地址+偏移地址=物理地址”寻址模式的一种具体解决方案。8086CPU中，段地址x16可看作是基础地址。

## 2.8 段的概念

内存没有分段，段的划分来自CPU,由于8086CPU用”段地址x16+偏移地址=物理地址“的方式给出内存单元的物理地址，使得我们可以用分段的方式来管理内存。
![[Pasted image 20220116161040.png]]
上述两种方式都是分段的方法。在编程时根据需要，将若干地址连续的内存单元看作一个段，用段地是x16定位段的起始位置（基础位置），用偏移地址定位段中的内存单元。需注意：
+ 段地址x16必然是16的倍数，所以一个段的起始地址也一定是16的倍数
+ 偏移地址为16位，16位地址的寻址能力为64KB,所以一个段的长度最大为64KB

## 检测点 2.2

1. 00010H ~ 1000FH
2. 10001H ~ 20000H

## 2.9 段寄存器

8086CPU在访问内存时要由段寄存器提供内存单元的段地址和偏移地址，送入地址加法器中合成物理地址。8086CPU中有4个段寄存器：`CS,DS,SS,ES`。当8086CPU要访问内存时，由这四个段寄存器提供内存单元的段地址。

## 2.10 CS和IP

CS为代码寄存器，IP为指令指针寄存器，**提供了CPU要执行指令的地址**
在8086PC机中，任意时刻，设CS中的内容为M，IP中的内容为N，8086CPU将从内存Mx16+N单元开始，读取一条指令并执行。

>等价于：8086机 中，任意时刻，CPU将CS:IP指向的内容当作指令执行

```
 -> 1. CS:IP指向内存单元读取指令，读取的指令进入指令缓冲器
 |  2. IP= IP + 所读取的指令长度，从而指向下一条指令
 -- 3. 执行指令
```

8086CPU加电启动或复位后，CS和IP被设置为CS=FFFFH，IP=0000H，即在8086PC机刚启动时，CPU从内存FFFF0H单元中读取指令执行，FFFF0H单元中的指令是8086PC机开机后执行的第一条指令。

> Q：CPU根据什么将信息视作指令？
> A：CPU将CS:IP指向的内存单元中的内容看作指令

如果内存中的一段信息被CPU执行过的话，它所在的内存空间必然被CS:IP指向过

## 2.11 修改CS, IP的指令

jmp指令：`jmp 段地址:偏移地址`，之后CPU将从该地址读取指令
若仅修改IP的内容，可以用`jmp 某一合法寄存器`的指令完成，例如
```asm
jmp ax, 指令执行前：ax = 1000H CS = 2000H IP = 0003H
		指令执行后: ax = 1000H CS = 2000H IP = 1000H
```

## 2.12 代码段

## 检测点 2.3

一共四次，三条指令读取完成后分别一次，但第三条指令执行完成后又有一次，最后IP中的值为0H

## 实验 1 查看CPU和内存，用机器指令和汇编指令编程

